
<!-- README.md is generated from README.Rmd. Please edit that file -->

# pkEML

<!-- badges: start -->
<!-- badges: end -->

A R package to convert Ecological Metadata Language (EML) documents to
tables, and, optionally, normalizes them into tables suited for import
into a relational database system, such as the LTER-core-metabase
schema. Data managers can use pkEML to aid migration of their metadata
archives, while researchers working on meta-analyses can use pkEML to
quickly gather metadata details from a large set of datasets. While
pkEML was developed with the LTER network in mind, any EML users may
find its functionalities useful.

How to say “pkEML”: spell out each letter. pk is meant to stand for
primary key, but one can also intepret as peak-EML or pack-EML.

## Installation

``` r
# Requires the remotes package
install.packages("remotes")
#> Installing package into 'C:/Software/Anaconda/Temp/RtmpYhuIxJ/temp_libpath44b4725c2b1a'
#> (as 'lib' is unspecified)
remotes::install_github("atn38/pkEML")
#> Downloading GitHub repo atn38/pkEML@HEAD
#> Installing package into 'C:/Software/Anaconda/Temp/RtmpYhuIxJ/temp_libpath44b4725c2b1a'
#> (as 'lib' is unspecified)
#> Warning in i.p(...): installation of package 'C:/Software/Anaconda/Temp/
#> Rtmpk1pDxq/file5b643df04951/pkEML_0.1.0.tar.gz' had non-zero exit status
```

## How to use pkEML

``` r
library(pkEML)
```

### Step 1: Assemble a “corpus” of EML documents

A corpus of EML documents can correspond to a research program’s
metadata archives, or any set of assembled metadata documents. A corpus
is the unit of input data that pkEML operates on. So, if we are talking
about getting geographic coverage metadata, or any other metadata
element, the default is grabbing these things from *a whole corpus in
one go*. You can of course use pkEML to grab metadata from a single EML
document, but there are perhaps other methods to do so, such as the
package metajam from NCEAS, or the function `purrr::pluck()`.

pkEML has a function to quickly and conveniently download all EML
documents from an Environment Data Initiative (EDI) repository’s
“scope”:

``` r
pkEML::download_corpus(scope = "knb-lter-ble", path = getwd())
#> Querying EDI for latest data identifiers...
#> Starting download:
#> Writing file knb-lter-ble.1.7.xml to path.
#> Writing file knb-lter-ble.2.4.xml to path.
#> Writing file knb-lter-ble.3.1.xml to path.
#> Writing file knb-lter-ble.4.1.xml to path.
#> Writing file knb-lter-ble.5.4.xml to path.
#> Writing file knb-lter-ble.6.1.xml to path.
#> Writing file knb-lter-ble.7.4.xml to path.
#> Writing file knb-lter-ble.8.7.xml to path.
#> Writing file knb-lter-ble.9.1.xml to path.
#> Writing file knb-lter-ble.10.1.xml to path.
#> Writing file knb-lter-ble.11.1.xml to path.
#> Writing file knb-lter-ble.12.1.xml to path.
#> Writing file knb-lter-ble.13.1.xml to path.
#> Writing file knb-lter-ble.14.3.xml to path.
#> Writing file knb-lter-ble.15.1.xml to path.
#> Writing file knb-lter-ble.16.1.xml to path.
#> Writing file knb-lter-ble.17.1.xml to path.
#> Writing file knb-lter-ble.18.2.xml to path.
#> Writing file knb-lter-ble.19.1.xml to path.
#> Writing file knb-lter-ble.22.1.xml to path.
#> Writing file knb-lter-ble.23.1.xml to path.
#> Done.
```

This downloads into the specified directory all EML documents from the
most recent revisions of datasets under the “knb-lter-ble” scope in EDI,
which is the Beaufort Lagoon Ecosystems LTER program.

If working with a more heterogeneous set, use your favorite method to
download the EML documents into a directory.

### Step 2: Import the EML corpus into R

``` r
emls <- import_corpus(path = getwd())
#> Starting import...
#> Getting packageIds to use as names...
#> Checking for duplicate Ids...
#> Done.
```

`import_corpus` outputs a nested list of EML documents represented under
the `emld` format. Each list item is a EML document and named after the
full packageId in the metadata body (not the .xml file name in the
directory).

### Step 3: Convert EML corpus to tables

``` r
dfs <- EML2df(corpus = emls)
#> Getting datasets...
#>     Returning 21 rows.
#> Getting data entities...
#>     Returning 75 rows.
#> Getting entity attributes...
#>     Returning 1060 rows.
#> Getting attribute enumeration and missing codes...
#>     Returning 287 rows.
#> Getting keywordSet ...
#>     Returning 469 rows.
#> Getting changeHistory ...
#>     Returning 21 rows.
#> Getting geographicCoverage ...
#>     Returning 58 rows.
#> Getting temporalCoverage ...
#>     Returning 19 rows.
#> Getting taxonomicCoverage ...
#>     Returning 0 rows.
#> Getting project ...
#>     Returning 21 rows.
#> Getting annotation ...
#>     Returning 182 rows.
#> Getting methodStep ...
#>     Returning 22 rows.
```

`dfs` is a nested list of data.frames. Each data.frame will contain
assembled information from all your datasets, each on key metadata
groups such as dataset-level information, entity-level, attribute-level,
attribute codes (enumeration and missing),
geographical/temporal/taxonomic coverage, and so on. These data.frames
are de-normalized, meaning all occurrences in EML are recorded and there
may be loads of repeated information. For example, key personnel from
your research program will be listed as contributors on many datasets,
core sampling locations will be listed many times, and so on.

``` r
str(dfs)
#> List of 13
#>  $ datasets     :Classes 'data.table' and 'data.frame':  21 obs. of  10 variables:
#>   ..$ packageId                   : chr [1:21] "knb-lter-ble.1.7" "knb-lter-ble.10.1" "knb-lter-ble.11.1" "knb-lter-ble.12.1" ...
#>   ..$ scope                       : chr [1:21] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid                   : chr [1:21] "1" "10" "11" "12" ...
#>   ..$ revision_number             : chr [1:21] "7" "1" "1" "1" ...
#>   ..$ title                       : chr [1:21] "Carbon flux from aquatic ecosystems of the Arctic Coastal Plain along the Beaufort Sea, Alaska, 2010-2018" "Catalog of GenBank sequence read archive (SRA) entries of 16S and 18S rRNA genes from bacterial and protistan p"| __truncated__ "Carbon and nitrogen content and stable isotope compositions from particulate organic matter samples from lagoon"| __truncated__ "Sediment pigment concentrations from lagoon sites along the Alaska Beaufort Sea coast, 2018-ongoing" ...
#>   ..$ shortname                   : logi [1:21] NA NA NA NA NA NA ...
#>   ..$ abstract                    : chr [1:21] "Multiple aquatic ecosystems (pond, lake, river, lagoon, ocean) on the Arctic Coastal Plain (ACP) near Utqiagvik"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <para>Microbial communities in the coastal Arctic Ocean experie"| __truncated__ "Multiple water types (river, lagoon, ocean) from the North Slope of Alaska and nearshore Beaufort Sea are sampl"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <para>\nThe Beaufort Lagoon Ecosystems Long Term Ecological Res"| __truncated__ ...
#>   ..$ abstract_type               : chr [1:21] "plaintext" "docbook" "plaintext" "docbook" ...
#>   ..$ maintenance_description     : chr [1:21] "No regular updates scheduled." "No regular updates anticipated." "Dataset will be updated every year, normally scheduled for the fall and spring following field season." "Dataset will be updated every year, normally scheduled for the fall and spring following field season." ...
#>   ..$ maintenance_update_frequency: 'AsIs' chr [1:21] "notPlanned" "notPlanned" "annually" "annually" ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ entities     :Classes 'data.table' and 'data.frame':  75 obs. of  12 variables:
#>   ..$ scope            : chr [1:75] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid        : chr [1:75] "1" "1" "1" "1" ...
#>   ..$ rev              : chr [1:75] "7" "7" "7" "7" ...
#>   ..$ entity           : chr [1:75] "11" "12" "13" "14" ...
#>   ..$ entitytype       : chr [1:75] "dataTable" "dataTable" "dataTable" "dataTable" ...
#>   ..$ entityname       : chr [1:75] "Regional survey" "Elson 2015 spatial survey" "IBP C diel pCO2 data" "IBP C Daily NEP" ...
#>   ..$ entitydescription: chr [1:75] "Water chemistry from multiple aquatic ecosystems" "pCO2 survey of Elson Lagoon from 2015" "Diel pCO2 in tundra pond over 4 summers" "Summer Net Ecosystem Production (NEP) in tundra pond over 4 summers" ...
#>   ..$ nrow             : chr [1:75] "231" "2963" "1168" "286" ...
#>   ..$ filename         : chr [1:75] "regional_survey.csv" "Elson_2015_spatial_survey.csv" "IBP_C_diel_pCO2.csv" "IBP_C_Daily_NEP.csv" ...
#>   ..$ filesize         : chr [1:75] "31626" "224030" "71190" "14092" ...
#>   ..$ filesizeunit     : chr [1:75] "byte" "byte" "byte" "byte" ...
#>   ..$ checksum         : chr [1:75] "65c40c28f5373fd8ad5da428f4b2afeb" "5d7d2753c65ee3eb921742d7d1e580b8" "d3a158536bc6bcc4b354e8c3220b8801" "3e953a033cc23f2c35f58a0cd14c73a1" ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ attributes   :Classes 'data.table' and 'data.frame':  1060 obs. of  38 variables:
#>   ..$ scope              : chr [1:1060] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid          : chr [1:1060] "1" "1" "1" "1" ...
#>   ..$ rev                : chr [1:1060] "7" "7" "7" "7" ...
#>   ..$ entity             : chr [1:1060] "11" "11" "11" "11" ...
#>   ..$ entitytype         : chr [1:1060] "dataTable" "dataTable" "dataTable" "dataTable" ...
#>   ..$ id                 : chr [1:1060] "d1-e1-att1" "d1-e1-att2" "d1-e1-att3" "d1-e1-att4" ...
#>   ..$ attributeName      : chr [1:1060] "Year" "Habitat" "FwSal" "Site" ...
#>   ..$ attributeLabel     : chr [1:1060] "Year" "Habitat" "Freshwater or Saline" "Site" ...
#>   ..$ attributeDefinition: chr [1:1060] "Year data were collected" "Habitat type (pond, lake, river, lagoon, ocean)" "Identifies freshwater or saline (incl. brackish) conditions" "Site name. Not to be confused with a \"site\" defined in the EML element geographicCoverage" ...
#>   ..$ storageType        : chr [1:1060] "integer" "string" "string" "string" ...
#>   ..$ formatString       : chr [1:1060] "YYYY" NA NA NA ...
#>   ..$ dateTimePrecision  : chr [1:1060] "1" NA NA NA ...
#>   ..$ measurementScale   : chr [1:1060] "dateTime" "nominal" "nominal" "nominal" ...
#>   ..$ domain             : chr [1:1060] "dateTimeDomain" "enumeratedDomain" "enumeratedDomain" "textDomain" ...
#>   ..$ definition         : chr [1:1060] NA NA NA "any text" ...
#>   ..$ unit               : chr [1:1060] NA NA NA NA ...
#>   ..$ numberType         : chr [1:1060] NA NA NA NA ...
#>   ..$ minimum            : chr [1:1060] NA NA NA NA ...
#>   ..$ maximum            : chr [1:1060] NA NA NA NA ...
#>   ..$ code               : chr [1:1060] NA NA NA NA ...
#>   ..$ codeExplanation    : chr [1:1060] NA NA NA NA ...
#>   ..$ precision          : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ label              : chr [1:1060] NA NA NA NA ...
#>   ..$ code               : chr [1:1060] NA NA NA NA ...
#>   ..$ codeExplanation    : chr [1:1060] NA NA NA NA ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ codes        :Classes 'data.table' and 'data.frame':  287 obs. of  10 variables:
#>   ..$ scope        : chr [1:287] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid    : chr [1:287] "1" "1" "1" "1" ...
#>   ..$ rev          : chr [1:287] "7" "7" "7" "7" ...
#>   ..$ entity       : chr [1:287] "11" "11" "11" "11" ...
#>   ..$ entitytype   : chr [1:287] "dataTable" "dataTable" "dataTable" "dataTable" ...
#>   ..$ attribute    : int [1:287] 2 2 2 2 2 2 2 3 3 6 ...
#>   ..$ attributeName: chr [1:287] "Habitat" "Habitat" "Habitat" "Habitat" ...
#>   ..$ codetype     : chr [1:287] "factor" "factor" "factor" "factor" ...
#>   ..$ code         : chr [1:287] "Lagoon" "LAKE" "POND" "Salt-River" ...
#>   ..$ definition   : chr [1:287] "Lagoon" "Lake" "Pond" "River influenced by saltwater intrusion from lagoon" ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ parties      :Classes 'data.table' and 'data.frame':  495 obs. of  18 variables:
#>   ..$ id          : chr [1:495] "1" "1" "1" "1" ...
#>   ..$ scope       : chr [1:495] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ rev         : chr [1:495] "7" "7" "7" "7" ...
#>   ..$ order       : chr [1:495] "11" "12" NA NA ...
#>   ..$ type        : chr [1:495] "creator" "creator" "contact" "publisher" ...
#>   ..$ role        : chr [1:495] NA NA NA NA ...
#>   ..$ firstname   : 'AsIs' chr [1:495] NA "Vanessa L" NA NA ...
#>   ..$ surname     : chr [1:495] NA "Lougheed" NA NA ...
#>   ..$ organization: chr [1:495] "Beaufort Lagoon Ecosystems LTER" "The University of Texas at El Paso" "Beaufort Lagoon Ecosystems LTER" "Beaufort Lagoon Ecosystems LTER" ...
#>   ..$ position    : chr [1:495] NA NA "Information Manager" NA ...
#>   ..$ address     : chr [1:495] "750 Channel View Dr." "500 W University Ave Department of Biological Sciences" "MC R8000 The University of Texas at Austin" "750 Channel View Dr." ...
#>   ..$ city        : chr [1:495] "Port Aransas" "El Paso" "Austin" "Port Aransas" ...
#>   ..$ state       : chr [1:495] "TX" "TX" "TX" "TX" ...
#>   ..$ country     : chr [1:495] "USA" "USA" "USA" "USA" ...
#>   ..$ zip         : chr [1:495] "78373" "79902" "78712" "78373" ...
#>   ..$ phone       : chr [1:495] NA "915-747-6887" NA NA ...
#>   ..$ email       : 'AsIs' chr [1:495] "BLE-IM@utexas.edu" "vlougheed@utep.edu" "BLE-IM@utexas.edu" "BLE-IM@utexas.edu" ...
#>   ..$ online_url  : 'AsIs' chr [1:495] "https://ble.lternet.edu/" "https://expertise.utep.edu/node/26254\r\n" "https://ble.lternet.edu/" "https://ble.lternet.edu/" ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ keywords     :Classes 'data.table' and 'data.frame':  469 obs. of  6 variables:
#>   ..$ scope      : chr [1:469] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid  : chr [1:469] "1" "1" "1" "1" ...
#>   ..$ rev        : chr [1:469] "7" "7" "7" "7" ...
#>   ..$ keyword    : chr [1:469] "movement of inorganic matter" "movement of organic matter" "primary production" "aquatic ecosystems" ...
#>   ..$ keywordtype: chr [1:469] "theme" "theme" "theme" "theme" ...
#>   ..$ thesaurus  : chr [1:469] "LTER Core Research Areas" "LTER Core Research Areas" "LTER Core Research Areas" "LTER Controlled Vocabulary v1" ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ changehistory:Classes 'data.table' and 'data.frame':  21 obs. of  8 variables:
#>   ..$ scope       : chr [1:21] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid   : chr [1:21] "1" "1" "1" "1" ...
#>   ..$ rev         : chr [1:21] "7" "7" "7" "7" ...
#>   ..$ change_scope: chr [1:21] "Metadata and data" "Metadata" "Metadata" "Metadata" ...
#>   ..$ date        : chr [1:21] "2019-04-29" "2019-05-09" "2019-05-15" "2019-05-15" ...
#>   ..$ old_value   : chr [1:21] "No previous revision" "See previous revision 1" "See previous revision 2" "See previous revision 3" ...
#>   ..$ new_value   : logi [1:21] NA NA NA NA NA NA ...
#>   ..$ note        : chr [1:21] "An Nguyen : First upload." "An Nguyen : Second upload: add Andy Mahoney's ORCID and change BLE-LTER from organization creator to personal." "An Nguyen : Edit metadata to comply with Arctic Data Center's requirements." "An Nguyen : Edit metadata to comply with Arctic Data Center's requirements." ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ geocov       :Classes 'data.table' and 'data.frame':  58 obs. of  16 variables:
#>   ..$ scope             : chr [1:58] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid         : chr [1:58] "1" "1" "1" "1" ...
#>   ..$ rev               : chr [1:58] "7" "7" "7" "7" ...
#>   ..$ entity            : logi [1:58] NA NA NA NA NA NA ...
#>   ..$ entitytype        : logi [1:58] NA NA NA NA NA NA ...
#>   ..$ attribute         : logi [1:58] NA NA NA NA NA NA ...
#>   ..$ attributename     : logi [1:58] NA NA NA NA NA NA ...
#>   ..$ geographicCoverage: int [1:58] 1 2 3 4 5 1 2 3 4 5 ...
#>   ..$ desc              : chr [1:58] "Bounding box, knb-lter-ble.1: Located in North Slope, Alaska, USA, close to Utqiagvik (formerly Barrow). Encomp"| __truncated__ "Elson Lagoon: Located in North Slope, Alaska, USA, close to Utqiagvik (formerly Barrow). Extent determined from"| __truncated__ "Elson West Lagoon Deep Station 1: Located in North Slope, Alaska, USA, close to Utqiagvik (formerly Barrow). Co"| __truncated__ "Elson West Lagoon Shallow Station 1: Coordinates based on WGS84 datum." ...
#>   ..$ west              : chr [1:58] "-157.305763" "-156.603000" "-156.416500" "-156.564790" ...
#>   ..$ east              : chr [1:58] "-155.926235" "-155.914000" "-156.416500" "-156.564790" ...
#>   ..$ north             : chr [1:58] "71.383133" "71.395000" "71.337900" "71.328940" ...
#>   ..$ south             : chr [1:58] "71.025905" "71.158000" "71.337900" "71.328940" ...
#>   ..$ altitude_min      : logi [1:58] NA NA NA NA NA NA ...
#>   ..$ altitude_max      : logi [1:58] NA NA NA NA NA NA ...
#>   ..$ altitude_unit     : logi [1:58] NA NA NA NA NA NA ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ tempocov     :Classes 'data.table' and 'data.frame':  19 obs. of  13 variables:
#>   ..$ scope                          : chr [1:19] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid                      : chr [1:19] "1" "10" "11" "12" ...
#>   ..$ rev                            : chr [1:19] "7" "1" "1" "1" ...
#>   ..$ entity                         : logi [1:19] NA NA NA NA NA NA ...
#>   ..$ entitytype                     : logi [1:19] NA NA NA NA NA NA ...
#>   ..$ attribute                      : logi [1:19] NA NA NA NA NA NA ...
#>   ..$ attributename                  : logi [1:19] NA NA NA NA NA NA ...
#>   ..$ temporalCoverage               : int [1:19] 1 1 1 1 1 1 1 1 1 1 ...
#>   ..$ datetype                       : chr [1:19] "range of dates" "range of dates" "range of dates" "range of dates" ...
#>   ..$ begin                          : chr [1:19] "2010-06-12" "2011-08-07" "2018-07-23" "2018-07-26" ...
#>   ..$ end                            : chr [1:19] "2018-08-02" "2013-08-14" "2019-08-10" "2019-08-10" ...
#>   ..$ alternativeTimeScaleName       : logi [1:19] NA NA NA NA NA NA ...
#>   ..$ alternativeTimeScaleAgeEstimate: logi [1:19] NA NA NA NA NA NA ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ taxcov       :Classes 'data.table' and 'data.frame':  0 obs. of  0 variables
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ projects     :Classes 'data.table' and 'data.frame':  21 obs. of  6 variables:
#>   ..$ scope    : chr [1:21] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid: chr [1:21] "1" "10" "11" "12" ...
#>   ..$ rev      : chr [1:21] "7" "1" "1" "1" ...
#>   ..$ title    : chr [1:21] "LTER: Beaufort Sea Lagoons: An Arctic Coastal Ecosystem in Transition" "LTER: Beaufort Sea Lagoons: An Arctic Coastal Ecosystem in Transition" "LTER: Beaufort Sea Lagoons: An Arctic Coastal Ecosystem in Transition" "LTER: Beaufort Sea Lagoons: An Arctic Coastal Ecosystem in Transition" ...
#>   ..$ abstract : chr [1:21] "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <section>\n    <para>\nThis project established a new Long Term"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <section>\n    <para>\nThis project established a new Long Term"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <section>\n    <para>\nThis project established a new Long Term"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <section>\n    <para>\nThis project established a new Long Term"| __truncated__ ...
#>   ..$ funding  : chr [1:21] "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <section>\n    <para>BLE LTER is supported by the National Scie"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <section>\n    <para>BLE LTER is supported by the National Scie"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <section>\n    <para>BLE LTER is supported by the National Scie"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <section>\n    <para>BLE LTER is supported by the National Scie"| __truncated__ ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ annotations  :Classes 'data.table' and 'data.frame':  182 obs. of  12 variables:
#>   ..$ scope        : chr [1:182] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid    : chr [1:182] "1" "1" "1" "1" ...
#>   ..$ rev          : chr [1:182] "7" "7" "7" "7" ...
#>   ..$ entity       : chr [1:182] NA "11" "11" "11" ...
#>   ..$ entitytype   : chr [1:182] NA "dataTable" "dataTable" "dataTable" ...
#>   ..$ attribute    : int [1:182] NA 12 13 14 15 17 18 6 7 8 ...
#>   ..$ attributename: chr [1:182] NA "WaterTemp_C" "pCO2_uatm" "Wind_m_s" ...
#>   ..$ annotation   : int [1:182] 1 1 1 1 1 1 1 1 1 1 ...
#>   ..$ propertylabel: chr [1:182] "isAbout" "containsMeasurementsOfType" "containsMeasurementsOfType" "containsMeasurementsOfType" ...
#>   ..$ propertyURI  : chr [1:182] "http://purl.obolibrary.org/obo/IAO_0000136" "http://ecoinformatics.org/oboe/oboe.1.2/oboe-core.owl#containsMeasurementsOfType" "http://ecoinformatics.org/oboe/oboe.1.2/oboe-core.owl#containsMeasurementsOfType" "http://ecoinformatics.org/oboe/oboe.1.2/oboe-core.owl#containsMeasurementsOfType" ...
#>   ..$ valuelabel   : chr [1:182] "lagoon" "Water Temperature" "carbon dioxide partial pressure" "wind speed" ...
#>   ..$ valueURI     : chr [1:182] "http://purl.obolibrary.org/obo/ENVO_00000038" "http://purl.dataone.org/odo/ECSO_00001227" "http://purl.dataone.org/odo/ECSO_00000636" "http://purl.dataone.org/odo/ECSO_00001233" ...
#>   ..- attr(*, ".internal.selfref")=<externalptr> 
#>  $ methods      :Classes 'data.table' and 'data.frame':  22 obs. of  10 variables:
#>   ..$ scope            : chr [1:22] "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" "knb-lter-ble" ...
#>   ..$ datasetid        : chr [1:22] "1" "10" "11" "12" ...
#>   ..$ rev              : chr [1:22] "7" "1" "1" "1" ...
#>   ..$ entity           : logi [1:22] NA NA NA NA NA NA ...
#>   ..$ entitytype       : logi [1:22] NA NA NA NA NA NA ...
#>   ..$ attribute        : logi [1:22] NA NA NA NA NA NA ...
#>   ..$ attributename    : logi [1:22] NA NA NA NA NA NA ...
#>   ..$ methodStep       : int [1:22] 1 1 1 1 1 1 1 1 1 1 ...
#>   ..$ methoddescription: chr [1:22] "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <para>\n  pCO2 (partial pressure of carbon dioxide) was monitor"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <para>\nTo investigate seasonal changes in bacterial and protis"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <para>\nWater samples are collected by hand (near surface “grab"| __truncated__ "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n  <para>\nUndisturbed surface sediment is collected from Beaufort"| __truncated__ ...
#>   ..$ methodtype       : chr [1:22] "docbook" "docbook" "docbook" "docbook" ...
#>   ..- attr(*, ".internal.selfref")=<externalptr>
```

### Step 4: Normalize tables

``` r
# tbls <- normalize_tables(dfs)
```

## Customized usage of pkEML

### Stop when you have what you want

One can stop at any point in the above sequence, of course. A logical
place to stop would be after running `EML2df` on your EML corpus. At
this point, you’ve got a set of rich tables to do a lot with.

### Getting specific metadata elements

`EML2df` simply wraps around a set of more granular `get_` functions.
These are all exported functions and can be used to get specific
metadata elements in table form:

``` r
datasets <- get_dataset(corpus = emls)
#> Getting datasets...
#>     Returning 21 rows.
taxonomy <- get_coverage_tax(corpus = emls)
#> Getting taxonomicCoverage ...
#>     Returning 0 rows.
```

### Getting a particular metadata element (that I didn’t write a `get_` function for)

Even more potentially powerful is the adaptable `get_multilevel_element`
and `get_datasetlevel_element` functions. These take a EML corpus, an
EML element name, and a parse function as arguments. For example,
`get_coverage_geo` is actually just a wrapper around
`get_multilevel_element`:

``` r
# get_coverage_geo(corpus = emls) 

# is equivalent to 

# get_multilevel_element(corpus = emls, element_names = c("coverage", "geographicCoverage"), parse_function = parse_geocov) 
```

`geographicCoverage` is an element that can be used to describe any
combination of datasets, entities, and attributes in EML.
`get_multilevel_element` grabs all occurrences of the
`geographicalCoverage` node at each level, then runs them through the
`parse_geocov` function, while preserving the context of where each
occurrence was – which dataset, which entity, which attribute.

Ditto for `get_datasetlevel_element`, a very similar function but works
only at the dataset level, since there are many EML elements unique to
this level.

To grab an EML element without a ready-made `get_` function, just write
a custom parse function and pass to these generic functions.

## Getting help

Report an issue and I’ll try my best to get to you.
